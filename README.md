# Task Manager API

A REST API built with Symfony and API Platform to manage tasks with full CRUD operations.

## Features
- ✅ Create, read, update, and delete tasks
- ✅ Mark tasks as completed
- ✅ Auto-generated API documentation (Swagger/OpenAPI)
- ✅ MySQL database integration
- ✅ Docker containerization
- ✅ CORS support

## Requirements
- Docker & Docker Compose
- PHP 8.4+ (for local development)

## Detailed Setup Instructions

### Step 1: Prerequisites Check
Before starting, ensure you have:
- Docker Desktop installed and running
- At least 4GB of free disk space
- Port 8080, 3306, and 8081 available (not in use)

### Step 2: Navigate to Project Directory
```bash
cd task-manager-api
```

### Step 3: Build and Start Docker Containers
```bash
docker-compose up -d --build
```

**What this does:**
- Builds the Docker image for PHP-FPM from the `Dockerfile`
- Starts 4 containers in the background:
  - `task_manager_api_php` - PHP-FPM application server
  - `task_manager_api_nginx` - Web server (reverse proxy)
  - `task_manager_api_db` - MySQL database
  - `task_manager_api_adminer` - Database management UI

**Verification:** Run `docker-compose ps` to see all containers running.

### Step 4: Wait for MySQL to Initialize
Wait **15-20 seconds** for the database container to fully start. You can check logs:
```bash
docker-compose logs db
```
Look for: `ready for connections`

### Step 5: Install PHP Dependencies
```bash
docker-compose exec app composer install
```

**What this does:**
- Installs all PHP packages listed in `composer.json` (Symfony, API Platform, Doctrine ORM, etc.)
- Creates the `vendor/` directory with all dependencies

### Step 6: Create Database Tables (Migrations)
First, generate a migration file from the Task entity:
```bash
docker-compose exec app php bin/console doctrine:migrations:diff
```

**What this does:**
- Compares your entity code with the database
- Generates a migration file in `migrations/` folder
- Shows SQL that will be executed

Then, run the migration:
```bash
docker-compose exec app php bin/console doctrine:migrations:migrate --no-interaction
```

**What this does:**
- Creates the `task` table in the database
- Executes the generated SQL
- Database is now ready for API requests

### Step 7: Verify Everything Works
Open your browser:
- **API Documentation:** http://localhost:8080/api
- **Database Manager:** http://localhost:8081 (User: symfony, Pass: secret)

**Quick API Test:**
```bash
curl http://localhost:8080/api/tasks
```
Should return: `[]` (empty task list)

---

## Code Organization & Architecture

### Directory Structure & Purpose

```
task-manager-api/
│
├── src/                           # Main application code
│   ├── Entity/
│   │   └── Task.php              # Task entity - represents DB table structure
│   │                             # Fields: id, title, description, isCompleted, createdAt
│   │                             # API Resource attributes define REST operations (GET, POST, PUT, PATCH, DELETE)
│   │
│   ├── Controller/               # (Empty) - API Platform generates endpoints automatically
│   │
│   ├── Repository/               # Database query methods (auto-generated by Doctrine)
│   │
│   ├── ApiResource/              # Custom API resources (if needed)
│   │
│   └── Kernel.php                # Symfony application kernel - loads all bundles
│
├── config/                        # Symfony configuration files
│   ├── packages/
│   │   ├── api_platform.yaml     # API Platform settings (title, version, defaults)
│   │   ├── doctrine.yaml         # Database ORM configuration
│   │   ├── doctrine_migrations.yaml # Migration settings
│   │   ├── framework.yaml        # Symfony core settings
│   │   ├── nelmio_cors.yaml      # CORS (cross-origin) configuration
│   │   └── security.yaml         # Authentication/authorization
│   │
│   ├── routes/
│   │   └── api_platform.yaml     # Routes config - API prefix set to /api
│   │
│   ├── services.yaml             # Dependency injection container
│   ├── bundles.php               # Bundle registration
│   └── routes.yaml               # Global routes
│
├── migrations/                    # Database migration files
│   └── (Generated automatically by Doctrine)
│
├── docker/
│   └── nginx/
│       └── default.conf          # Nginx configuration - routes requests to PHP-FPM
│
├── public/
│   └── index.php                 # Single entry point for all HTTP requests
│
├── docker-compose.yml            # Services definition (PHP, Nginx, MySQL, Adminer)
├── Dockerfile                    # Docker image recipe for PHP container
├── .env                          # Environment variables (DB credentials, ports)
├── composer.json                 # PHP dependencies and project metadata
└── README.md                     # This file
```

### Code Readability Principles

**1. Entity Design (Task.php)**
- Uses PHP 8 Attributes for configuration (clean, modern syntax)
- Field names are descriptive: `isCompleted` (not `is_comp`), `createdAt` (not `create_date`)
- Types are explicitly declared: `private string $title`, `private bool $isCompleted`
- Getter/Setter methods follow PSR-2 naming: `getTitle()`, `setTitle()`, `isCompleted()`
- Default values set via constructor: `createdAt` and `isCompleted` auto-initialize
- API Resource operations declared in single `#[ApiResource]` attribute for clarity

**2. Configuration Files**
- Organized by function: `doctrine.yaml` for DB, `api_platform.yaml` for API
- Clear comments explaining each section
- Environment variables used for sensitive data (`.env`)
- DRY principle: shared config in `packages/framework.yaml`

**3. Routing Strategy**
- Single API endpoint configured: `/api` prefix in `config/routes/api_platform.yaml`
- Automatic route generation by API Platform (no manual controller routing needed)
- Resources accessed via REST conventions: `/api/tasks`, `/api/tasks/{id}`

**4. Docker & Infrastructure**
- Single `docker-compose.yml` defines all services
- Clear service names: `app`, `web`, `db`, `adminer`
- Environment variables in `.env` for easy configuration
- Separate `docker/` folder for Docker-specific configs

**5. Dependency Management**
- `composer.json` lists all PHP dependencies with version constraints
- Vendor folder ignored in Git (`.gitignore`)
- Easy to install: `composer install`

### How API Requests Flow

```
1. Browser/Client sends HTTP request
   ↓
2. Nginx receives request (port 8080)
   ↓
3. Nginx forwards to PHP-FPM container
   ↓
4. Symfony routing matches URL to API
   ↓
5. API Platform reads Entity attributes
   ↓
6. Entity state manager (Doctrine) queries MySQL
   ↓
7. Response serialized as JSON
   ↓
8. Response sent back to client
```

### Example: Creating a Task

When you `POST /api/tasks` with `{"title":"Buy milk","description":"2L"}`:

1. **API Platform** recognizes the POST operation on the Task resource
2. **Doctrine** creates a new Task object from JSON data
3. **Entity Validator** checks required fields (title is required)
4. **Database Layer** executes `INSERT INTO task ...`
5. **Entity Constructor** sets `createdAt = now()` and `isCompleted = false`
6. **JSON Serializer** converts Task object to `{"id":1,"title":"Buy milk",...}`
7. **HTTP Response** returns 201 (Created) with the new task

---

## Quick Start

### 1. Clone/Navigate to Project
```bash
cd task-manager-api
```

### 2. Start Docker Containers
```bash
docker compose up -d --build
```
This starts:
- PHP-FPM application container
- Nginx web server (port 8080)
- MySQL database (port 3306)
- Adminer database manager (port 8081)

### 3. Wait for Database & Install Dependencies
```bash
# Wait 10-15 seconds for MySQL to be ready

# Install composer dependencies
docker compose exec app composer install
```

### 4. Create & Run Database Migrations
```bash
# Generate migration from Task entity
docker compose exec app php bin/console doctrine:migrations:diff

# Run the migration to create tables
docker compose exec app php bin/console doctrine:migrations:migrate --no-interaction
```

## Access the API

### API Documentation (Interactive)
Visit: **http://localhost:8080/api**

This shows the Swagger UI with full API documentation and the ability to test endpoints directly.

### Database Manager (Adminer)
Visit: **http://localhost:8081**
- Server: `db`
- Username: `symfony`
- Password: `secret`
- Database: `task_manager_api`

## API Endpoints

All endpoints are prefixed with `/api`

### List all tasks
```
GET /api/tasks
```

### Create a new task
```
POST /api/tasks
Content-Type: application/json

{
  "title": "Buy groceries",
  "description": "Milk, eggs, bread",
  "isCompleted": false
}
```

### Get a specific task
```
GET /api/tasks/{id}
```

### Update a task (PUT - replace all fields)
```
PUT /api/tasks/{id}
Content-Type: application/json

{
  "title": "Buy groceries",
  "description": "Updated description",
  "isCompleted": false
}
```

### Partial update (PATCH - update specific fields)
```
PATCH /api/tasks/{id}
Content-Type: application/json

{
  "isCompleted": true
}
```

### Mark a task as completed
```
PATCH /api/tasks/{id}
Content-Type: application/json

{
  "isCompleted": true
}
```

### Delete a task
```
DELETE /api/tasks/{id}
```

## Database Schema

### Task Table
| Field | Type | Default | Notes |
|-------|------|---------|-------|
| id | INT | AUTO_INCREMENT | Primary key |
| title | VARCHAR(255) | - | Required |
| description | TEXT | NULL | Optional |
| isCompleted | BOOLEAN | false | Default false |
| createdAt | DATETIME | NOW() | Auto-set on creation |

## Project Structure
```
task-manager-api/
├── config/              # Symfony configuration
│   ├── packages/       # Bundle configurations
│   └── routes/         # API routing
├── src/
│   ├── Entity/         # Task entity
│   ├── Controller/     # API controllers (if needed)
│   └── Kernel.php      # Application kernel
├── migrations/         # Database migrations
├── docker/            # Docker configurations
│   └── nginx/         # Nginx config
├── docker-compose.yml # Docker Compose setup
├── Dockerfile         # PHP-FPM image
└── public/           # Web root
```

## Troubleshooting

### Containers won't start
```bash
# Check Docker logs
docker compose logs app
docker compose logs db

# Rebuild containers
docker compose down -v
docker compose up -d --build
```

### Database connection error
- Wait 15 seconds after `docker compose up` for MySQL to be ready
- Check `.env` DATABASE_URL is set correctly

### Migration errors
```bash
# Check current migration status
docker compose exec app php bin/console doctrine:migrations:status

# View generated migration
ls migrations/
```

### Clear cache
```bash
docker compose exec app php bin/console cache:clear
```

## Notes
- Database name: `task_manager_api`
- Default `isCompleted` value is `false`
- `createdAt` timestamp is automatically set when a task is created
- All API responses are in JSON format
- CORS is enabled for local development

## Development

### Stop containers
```bash
docker compose down
```

### Stop and remove all data
```bash
docker compose down -v
```

### View logs
```bash
docker compose logs -f app
```

### Execute Symfony commands
```bash
docker compose exec app php bin/console [command]
```
